--- 
title: "UC Student High-Power Rocketry"
author: "Brandon Stark"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
# url: your book url like https://bookdown.org/yihui/bookdown
# cover-image: path to the social sharing image like images/cover.jpg
description: |
  This is a minimal example of using the bookdown package to write a book.
  The HTML output format for this example is bookdown::gitbook,
  set in the _output.yml file.
link-citations: yes
github-repo: 
---

# About

This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports; for example, a math equation $a^2 + b^2 = c^2$.

```{r, echo=FALSE, message = FALSE}
library(tidyverse)
library(readxl)
```

## Usage 3

Each **bookdown** chapter is an .Rmd file, and each .Rmd file can contain one (and only one) chapter. A chapter *must* start with a first-level heading: `# A good chapter`, and can contain one (and only one) first-level heading.

Use second-level and higher headings within chapters like: `## A short section` or `### An even shorter section`.

The `index.Rmd` file is required, and is also your first book chapter. It will be the homepage when you render the book.
```{r, echo=FALSE, warning=FALSE}
total_gantt<-read.csv("dev_gantt.csv",h=T)



print_campus = function(total_gantt,campus){

gantt<-filter(total_gantt, Campus==campus)


today_Date <- Sys.Date()



start_Date <-as.Date(min(gsub("\\.","-",gantt$Start)))
end_Date <- as.Date(max(gsub("\\.","-",gantt$End)))+weeks(1)

gantt["End"][gantt["End"]=="0"]<-format(end_Date,"%Y.%m.%d")

gantt<-gantt[order(as.Date(gantt$Start,format="%Y.%m.%d")),]

acts<-unique(as.character(gantt$Activity))
els <-unique(as.character(gantt$Status))

actcols <- c("#548235", "#2E75B6", "#BF9000", "#7030A0", "#cd6600")

g.gantt <- gather(gantt, "state", "date", 6:7) %>% mutate(date = as.Date(date, "%Y.%m.%d"), Activity=factor(Activity, acts[length(acts):1]), Status=factor(Status, els))

ggplot(g.gantt, aes(date, Activity, colour = Status, group=Item)) +
  geom_line(linewidth = 10) +
  scale_color_manual(values=actcols, name="Key") +
  labs(x="Date", y=NULL, title=campus) + 
  scale_x_date(date_labels = "%b %d")+
  theme_gray(base_size=14)+
  annotate(geom = "vline",
           x = today_Date,
           xintercept = today_Date,
           linetype = "dashed",
           colour = "red", 
           linewidth = 1.5) 
}

print_campus(total_gantt,"Berkeley")

```

## Render book

```{r, echo=FALSE, warning=FALSE }

total_xcl<-read_excel("UC_HPR.xlsx", sheet = "Contacts")


campus = "Berkeley"
xcl<-filter(total_xcl, Campus==campus)
today_Date <- Sys.Date()

hs <- c("Item","Group","Status","Start","End")

fc <- xcl$ShortName
pc <- as.character(1:length(fc))
sc <- case_when(xcl$P_Interview==0 ~ "In Progress",xcl$P_Interview<=today_Date ~ "Completed", xcl$P_Interview>today_Date ~ "Planned")
tc <- xcl$P_contact
hc <- xcl$P_Interview

gnt <- data.frame(pc,fc,sc,tc,hc)
colnames(gnt) <- hs

gnt <- gnt %>% add_row(Item="3",Group="EHS",Status=case_when(is.na(xcl$R_Interview[1]) ~ "In Progress",xcl$E_Interview[1]<=today_Date ~ "Completed", xcl$E_Interview[1]>today_Date ~ "Planned"),Start=xcl$E_Contact[1],End=xcl$E_Interview[1])

gnt <- gnt %>% add_row(Item="4",Group="Risk",Status=case_when(is.na(xcl$R_Interview[1]) ~ "In Progress",xcl$R_Interview[1]<=today_Date ~ "Completed", xcl$R_Interview[1]>today_Date ~ "Planned"),Start=xcl$R_Contact[1],End=xcl$R_Interview[1])

gnt <- gnt %>% add_row(Item="5",Group="Faculty",Status=case_when(is.na(xcl$F_Interview[1]) ~ "In Progress",xcl$F_Interview[1]<=today_Date ~ "Completed", xcl$F_Interview[1]>today_Date ~ "Planned"),Start=xcl$F_Contact[1],End=xcl$F_Interview[1])

gnt <- gnt %>% add_row(Item="6",Group="Dean of Engineering",Status=case_when(is.na(xcl$D_Interview[1]) ~ "In Progress",xcl$D_Interview[1]<=today_Date ~ "Completed", xcl$D_Interview[1]>today_Date ~ "Planned"),Start=xcl$D_Contact[1],End=xcl$D_Interview[1])


start_Date <-as.Date(min(gsub("\\.","-",na.omit(gnt$Start))))
end_Date <- as.Date(max(gsub("\\.","-",na.omit(gnt$End))))+weeks(1)


gantt_plot <- na.omit(gnt)

gantt_plot["End"][is.na(gantt_plot["End"])]<-end_Date

gantt_plot<-gantt_plot[order(as.Date(gantt_plot$Start,format="%Y.%m.%d")),]

acts<-unique(as.character(gantt_plot$Group))
els <-unique(as.character(gantt_plot$Status))

actcols <- c("#548235", "#2E75B6", "#BF9000", "#7030A0", "#cd6600")

g.gantt_plot <- gather(gantt_plot, "state", "date", 4:5) %>% mutate(date = as.Date(date, "%Y.%m.%d"), Group=factor(Group, acts[length(acts):1]), Status=factor(Status, els))

ggplot(g.gantt_plot, aes(date, Group, colour = Status, group=Item)) +
  geom_line(linewidth = 10) +
  scale_color_manual(values=actcols, name="Key") +
  labs(x="Date", y=NULL, title=campus) + 
  scale_x_date(date_labels = "%b %d")+
  theme_gray(base_size=14)+
  annotate(geom = "vline",
           x = today_Date,
           xintercept = today_Date,
           linetype = "dashed",
           colour = "red", 
           linewidth = 1.5) 
```

```{r echo=FALSE}
complete_plot <- subset(gnt,select=c("Group","Status"))

ggplot(complete_plot,aes(y=1)) + 
  geom_bar(aes(fill=Status), position="fill") +
  scale_x_continuous(expand=expansion(0),labels = scales::percent_format())

```

You can render the HTML version of this example book without changing anything:

1. Find the **Build** pane in the RStudio IDE, and

1. Click on **Build Book**, then select your output format, or select "All formats" if you'd like to use multiple formats from the same book source files.

Or build the book from the R console:

```{r, eval=FALSE}
bookdown::render_book()
```

To render this example to PDF as a `bookdown::pdf_book`, you'll need to install XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.org/tinytex/>.

## Preview book

As you work, you may start a local server to live preview this HTML book. This preview will update as you edit the book when you save individual .Rmd files. You can start the server in a work session by using the RStudio add-in "Preview book", or from the R console:

```{r eval=FALSE}
bookdown::serve_book()
```


```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```
